<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Kristal_Goals_Clone_v5_Plus</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#ffffff; --panel:#ffffff; --text:#0b1220; --muted:#5b6672;
      --line:#e7edf3; --primary:#0d6efd; --accent:#22b8cf;
      --chip:#f5f9ff; --shadow:0 1px 2px rgba(16,24,40,.04), 0 8px 24px rgba(16,24,40,.08);
      --radius:16px;
    }
    html[data-theme="dark"]{
      --bg:#0b1020; --panel:#0f172a; --text:#e6eef9; --muted:#9aa7c1;
      --line:rgba(255,255,255,.12); --primary:#78c2ff; --accent:#7c81ff;
      --chip:rgba(255,255,255,.06); --shadow:0 8px 28px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:15px/1.6 'Inter',system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:1040px;margin:0 auto;padding:28px 18px}
    .top{display:flex;align-items:center;gap:12px;margin-bottom:14px}
    .brand{font-weight:700;letter-spacing:.2px}
    .spacer{flex:1}
    .toggle{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted);cursor:pointer}
    .accordion{display:grid;gap:12px;margin-top:18px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
    summary{list-style:none;cursor:pointer;padding:16px 16px;display:flex;align-items:center;gap:10px}
    summary::-webkit-details-marker{display:none}
    .badge{display:inline-block;background:var(--chip);color:var(--primary);border:1px solid var(--line);padding:4px 8px;border-radius:999px;font-size:12px}
    .content{padding:4px 16px 16px 16px;border-top:1px solid var(--line)}
    .row{display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:center;margin:10px 0}
    .label{font-weight:600}
    .stepper{display:inline-flex;align-items:center;gap:8px}
    .stepper button{width:36px;height:36px;border-radius:999px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:700;color:#444;box-shadow:0 1px 2px rgba(0,0,0,.05)}
    .pillInput{display:flex;border:1px solid var(--line);border-radius:10px;overflow:hidden;align-items:center}
    .pillInput .prefix{font-size:12px;color:var(--muted);background:var(--line);padding:8px 10px}
    .pillInput input, .pillInput select{border:0;padding:8px 12px;min-width:160px;background:transparent;color:var(--text)}
    .grid{display:grid;gap:12px}
    @media(min-width:760px){.grid.two{grid-template-columns:1fr 1fr}.grid.three{grid-template-columns:1fr 1fr 1fr}}
    .hint{font-size:12px;color:var(--muted);margin-left:8px}
    .section{padding:8px 0 16px 0;border-bottom:1px dashed var(--line)}
  
/* === Auto-calc summary tiles === */
.summary{display:grid;gap:12px;grid-template-columns:repeat(4,minmax(0,1fr));margin:8px 0 18px}
.tile{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:12px 14px;box-shadow:var(--shadow)}
.tile .k{color:var(--muted);font-size:12px}
.tile .v{font-weight:700;font-size:18px}
.tile .note{font-size:12px;color:var(--muted)}

</style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">Kristal Goals Clone — v5 Plus (with Income, Expenses, Investments, Loans, Goals, Insurances)</div>
      <div class="spacer"></div>
      <div class="toggle" id="themeToggle">Light / Dark</div>
    </div>

    
  <!-- === Auto-calculation Summary === -->
  <div class="summary">
    <div class="tile"><div class="k">Gross Monthly Income</div><div class="v" id="t_gmi">$0</div><div class="note">Salary + (annual incomes ÷ 12)</div></div>
    <div class="tile"><div class="k">Total Monthly Expenses (ex-EMI)</div><div class="v" id="t_me">$0</div><div class="note">Monthly + (annual ÷ 12)</div></div>
    <div class="tile"><div class="k">Monthly Debt Payments</div><div class="v" id="t_md">$0</div><div class="note">All EMIs + (EMI p.a ÷ 12)</div></div>
    <div class="tile"><div class="k">Savings Rate</div><div class="v" id="t_sr">0%</div><div class="note">(GMI − Expenses − EMIs) ÷ GMI</div></div>
    <div class="tile"><div class="k">Net Monthly Surplus</div><div class="v" id="t_nms">$0</div></div>
    <div class="tile"><div class="k">Net Annual Surplus</div><div class="v" id="t_nas">$0</div></div>
    <div class="tile"><div class="k">Debt-to-Income (DTI)</div><div class="v" id="t_dti">0%</div></div>
    <div class="tile"><div class="k">Estimated Net Worth</div><div class="v" id="t_nw">$0</div><div class="note">(Assets − Liabilities)</div></div>
  </div>


    <div class="accordion">

      <!-- 1) GENERAL QUESTIONS (v5 + added Gender, Marital, Dependents) -->
      <details class="card" open>
        <summary><span class="badge">1</span><strong>General Questions</strong></summary>
        <div class="content">

          <div class="section">
            <div class="row">
              <div class="label">Current Age in years <span class="hint">ⓘ</span></div>
              <div class="stepper">
                <button type="button" data-step="age" data-delta="-1">−</button>
                <button type="button" data-step="age" data-delta="1">+</button>
              </div>
              <div class="pillInput"><span class="prefix">yrs</span><input id="age" type="number" value="42"/></div>
            </div>
          </div>

          <div class="section">
            <div class="row">
              <div class="label">Retirement Age</div>
              <div class="stepper">
                <button type="button" data-step="retire_age" data-delta="-1">−</button>
                <button type="button" data-step="retire_age" data-delta="1">+</button>
              </div>
              <div class="pillInput"><span class="prefix">yrs</span><input id="retire_age" type="number" value="60"/></div>
            </div>
          </div>

          <div class="section">
            <div class="row">
              <div class="label">Current Fin. Investments</div>
              <div></div>
              <div class="pillInput"><span class="prefix">USD</span><input id="invest_now" type="text" value="0"/></div>
            </div>
          </div>

          <div class="section">
            <div class="row">
              <div class="label">Net Savings p.a.</div>
              <div></div>
              <div class="pillInput"><span class="prefix">USD/yr</span><input id="save_pa" type="text" value="0"/></div>
            </div>
          </div>

          <div class="section">
            <div class="row">
              <div class="label">Annual Increase in Net Savings</div>
              <div></div>
              <div class="pillInput"><span class="prefix">%</span><input id="save_g" type="number" value="5"/></div>
            </div>
          </div>

          <div class="section">
            <div class="row">
              <div class="label">Annual Retirement Expenses</div>
              <div></div>
              <div class="pillInput"><span class="prefix">USD/yr</span><input id="ret_exp" type="text" value="0"/></div>
            </div>
          </div>

          <div class="section">
            <div class="row">
              <div class="label">Inflation Rate</div>
              <div></div>
              <div class="pillInput"><span class="prefix">%</span><input id="infl" type="number" value="4"/></div>
            </div>
          </div>

          <!-- Added fields -->
          <div class="section" style="border-bottom:0">
            <div class="grid three">
              <div class="pillInput"><span class="prefix">Gender</span>
                <select id="gender"><option value="">Select</option><option>Male</option><option>Female</option><option>Other</option><option>Prefer not to say</option></select>
              </div>
              <div class="pillInput"><span class="prefix">Marital</span>
                <select id="marital"><option value="">Select</option><option>Single</option><option>Married</option><option>Divorced</option><option>Widowed</option></select>
              </div>
              <div class="pillInput"><span class="prefix">Dependents</span><input id="dependents" type="number" value="0" min="0"/></div>
            </div>
          </div>

        </div>
      </details>

      <!-- 2) HOME RENT EXPENSES (no change) -->
      <details class="card" id="rent" open>
        <summary><span class="badge">2</span><strong>Home Rent Expenses</strong></summary>
        <div class="content">
          <div class="section" style="border-bottom:0">
            <div class="row">
              <div class="label">Rent p.a <span class="hint">ⓘ</span></div>
              <div></div>
              <div class="pillInput"><span class="prefix">USD/yr</span><input id="rent_pa" type="text" value="0"/></div>
            </div>
            <div class="slider">
              <input type="range" id="s_rent_pa" min="0" max="200000" step="1000" value="0">
              <div class="ticks"><span>0</span><span>50K</span><span>100K</span><span>150K</span><span>200K</span></div>
            </div>
          </div>
        </div>
      </details>

      <!-- 3) HOME EMI EXPENSES (no change) -->
      <details class="card" id="emi" open>
        <summary><span class="badge">3</span><strong>Home EMI Expenses</strong></summary>
        <div class="content">
          <div class="grid three">
            <div class="pillInput"><span class="prefix">yrs</span><input id="hp_years" type="number" value="0"/></div>
            <div class="pillInput"><span class="prefix">yrs</span><input id="loan_tenure" type="number" value="10"/></div>
            <div class="pillInput"><span class="prefix">USD</span><input id="downpay" type="text" value="0"/></div>
          </div>
          <div class="section" style="border-bottom:0;margin-top:12px">
            <div class="row">
              <div class="label">EMI p.a <span class="hint">ⓘ</span></div>
              <div></div>
              <div class="pillInput"><span class="prefix">USD/yr</span><input id="emi_pa" type="text" value="0"/></div>
            </div>
            <div class="slider">
              <input type="range" id="s_emi_pa" min="0" max="200000" step="1000" value="0">
              <div class="ticks"><span>0</span><span>50K</span><span>100K</span><span>150K</span><span>200K</span></div>
            </div>
          </div>
        </div>
      </details>

      <!-- 4) CHILDREN’S UNIVERSITY EXPENSES (no change) -->
      <details class="card" id="edu" open>
        <summary><span class="badge">4</span><strong>Children’s University Expenses</strong></summary>
        <div class="content">
          <div class="grid two">
            <div class="pillInput"><span class="prefix">#</span><input id="kids_n" type="number" value="0" min="0"/></div>
            <div class="pillInput"><span class="prefix">USD/yr</span><input id="edu_cost_pa" type="text" value="0"/></div>
          </div>
        </div>
      </details>

      <!-- 5) INCOME DETAILS (new section) -->
      <details class="card" id="income" open>
        <summary><span class="badge">5</span><strong>Income Details</strong></summary>
        <div class="content">
          <div class="grid two">
            <div class="pillInput"><span class="prefix">USD/mo</span><input id="inc_takehome" type="text" placeholder="Monthly Take Home salary"/></div>
            <div class="pillInput"><span class="prefix">USD/yr</span><input id="inc_bonus" type="text" placeholder="Expected Annual bonus"/></div>
            <div class="pillInput"><span class="prefix">USD/yr</span><input id="inc_rent" type="text" placeholder="Rental income"/></div>
            <div class="pillInput"><span class="prefix">USD/yr</span><input id="inc_business" type="text" placeholder="Business income"/></div>
            <div class="pillInput"><span class="prefix">%/yr</span><input id="inc_rise" type="number" placeholder="Expected annual income rise"/></div>
            <div class="pillInput"><span class="prefix">USD/yr</span><input id="inc_invest" type="text" placeholder="Investment income (dividends, interest)"/></div>
            <div class="pillInput"><span class="prefix">USD/yr</span><input id="inc_other" type="text" placeholder="Any income from other sources"/></div>
          </div>
        </div>
      </details>

      <!-- 6) EXPENSES DETAILS (new section) -->
      <details class="card" id="expenses" open>
        <summary><span class="badge">6</span><strong>Expenses Details</strong></summary>
        <div class="content">
          <div class="grid two">
            <div class="pillInput"><span class="prefix">USD/mo</span><input id="exp_rent" type="text" placeholder="Monthly - House Rent"/></div>
            <div class="pillInput"><span class="prefix">USD/mo</span><input id="exp_school" type="text" placeholder="Monthly - School Fee details by Kid"/></div>
            <div class="pillInput"><span class="prefix">USD/mo</span><input id="exp_household" type="text" placeholder="Monthly -Total Household expenses (Bills & Groceries etc)"/></div>
            <div class="pillInput"><span class="prefix">USD/yr</span><input id="exp_vac" type="text" placeholder="Annual - Vacation"/></div>
            <div class="pillInput"><span class="prefix">USD/yr</span><input id="exp_disc" type="text" placeholder="Annual - Discretionary Purchases (Clothings, Mobile, Whitegoods)"/></div>
            <div class="pillInput"><span class="prefix">USD/yr</span><input id="exp_life" type="text" placeholder="Annual - Life Insurance Premiums"/></div>
            <div class="pillInput"><span class="prefix">USD/yr</span><input id="exp_health" type="text" placeholder="Annual - Health Insurance Premiums"/></div>
            <div class="pillInput"><span class="prefix">USD/yr</span><input id="exp_maint" type="text" placeholder="Annual - Maintenances (Appliances , Vehicle , Property)"/></div>
          </div>
        </div>
      </details>

      <!-- 7) INVESTMENTS (new section) -->
      <details class="card" id="investments" open>
        <summary><span class="badge">7</span><strong>Investments</strong></summary>
        <div class="content">
          <div class="grid two">
            <div class="pillInput"><span class="prefix">USD</span><input id="inv_mf" type="text" placeholder="Mutual Funds"/></div>
            <div class="pillInput"><span class="prefix">USD</span><input id="inv_stocks" type="text" placeholder="Stocks"/></div>
            <div class="pillInput"><span class="prefix">USD</span><input id="inv_bonds_fd" type="text" placeholder="Bonds & Fixed Deposits"/></div>
            <div class="pillInput"><span class="prefix">USD</span><input id="inv_ppf_epf_nps" type="text" placeholder="PPF, EPF, NPS"/></div>
            <div class="pillInput"><span class="prefix">USD</span><input id="inv_savings_bank" type="text" placeholder="Saving Bank Balances"/></div>
            <div class="pillInput"><span class="prefix">USD</span><input id="inv_realestate" type="text" placeholder="Real Estate (Value)"/></div>
            <div class="pillInput"><span class="prefix">USD</span><input id="inv_gold" type="text" placeholder="Gold Equivalents/jewelry"/></div>
            <div class="pillInput"><span class="prefix">USD</span><input id="inv_other" type="text" placeholder="Other investments (PMS, AIF, SIF)"/></div>
            <div class="pillInput"><span class="prefix">USD</span><input id="inv_any_other_5lac" type="text" placeholder="Any other Assets (>5Lac)"/></div>
          </div>
        </div>
      </details>

      <!-- 8) LOANS (new section) -->
      <details class="card" id="loans" open>
        <summary><span class="badge">8</span><strong>Loans</strong></summary>
        <div class="content">
          <div class="grid two">
            <div class="pillInput"><span class="prefix">USD</span><input id="loan_home_out" type="text" placeholder="Outstanding Home loan"/></div>
            <div class="pillInput"><span class="prefix">USD/mo</span><input id="loan_home_emi" type="text" placeholder="Home Loan EMI"/></div>
            <div class="pillInput"><span class="prefix">Date</span><input id="loan_home_close" type="date" placeholder="Home Loan Closure Date"/></div>

            <div class="pillInput"><span class="prefix">USD</span><input id="loan_car_out" type="text" placeholder="Outstanding Car loan"/></div>
            <div class="pillInput"><span class="prefix">USD/mo</span><input id="loan_car_emi" type="text" placeholder="Car Loan EMI"/></div>
            <div class="pillInput"><span class="prefix">Date</span><input id="loan_car_close" type="date" placeholder="Car Loan Closure Date"/></div>

            <div class="pillInput"><span class="prefix">USD</span><input id="loan_personal_out" type="text" placeholder="Outstanding Personal loan"/></div>
            <div class="pillInput"><span class="prefix">USD/mo</span><input id="loan_personal_emi" type="text" placeholder="Personal Loan EMI"/></div>
            <div class="pillInput"><span class="prefix">Date</span><input id="loan_personal_close" type="date" placeholder="Personal Loan Closure Date"/></div>

            <div class="pillInput"><span class="prefix">USD</span><input id="loan_edu_out" type="text" placeholder="Outstanding Education loan"/></div>
            <div class="pillInput"><span class="prefix">USD/mo</span><input id="loan_edu_emi" type="text" placeholder="Education loan EMI"/></div>
            <div class="pillInput"><span class="prefix">Date</span><input id="loan_edu_close" type="date" placeholder="Education Loan Closure Date"/></div>

            <div class="pillInput"><span class="prefix">USD</span><input id="loan_biz_out" type="text" placeholder="Outstanding Business loan"/></div>
            <div class="pillInput"><span class="prefix">USD/mo</span><input id="loan_biz_emi" type="text" placeholder="Business Loan EMI"/></div>
            <div class="pillInput"><span class="prefix">Date</span><input id="loan_biz_close" type="date" placeholder="Business Loan Closure Date"/></div>

            <div class="pillInput"><span class="prefix">USD</span><input id="loan_other_out" type="text" placeholder="Outstanding - other loan"/></div>
            <div class="pillInput"><span class="prefix">USD/mo</span><input id="loan_other_emi" type="text" placeholder="Other Loan EMI"/></div>
            <div class="pillInput"><span class="prefix">Date</span><input id="loan_other_close" type="date" placeholder="Other Loan Closure Date"/></div>
          </div>
        </div>
      </details>

      <!-- 9) GOALS (new section) -->
      <details class="card" id="goals" open>
        <summary><span class="badge">9</span><strong>Goals</strong></summary>
        <div class="content">

          <!-- a) Children's Education -->
          <div class="section">
            <div class="label">Children's Education</div>
            <div class="grid two" style="margin-top:8px">
              <div class="pillInput"><span class="prefix">Child Name</span><input id="g_ce_name" type="text" placeholder="e.g., Aarav"/></div>
              <div class="pillInput"><span class="prefix">Target Date</span><input id="g_ce_date" type="date" placeholder="Target Date of Admission"/></div>
              <div class="pillInput"><span class="prefix">Type</span>
                <select id="g_ce_type">
                  <option value="">Select</option>
                  <option>Graduation</option>
                  <option>Post-graduation</option>
                  <option>Professional course</option>
                </select>
              </div>
              <div class="pillInput"><span class="prefix">USD (today)</span><input id="g_ce_cost" type="number" placeholder="Current cost of education"/></div>
            </div>
          </div>

          <!-- b) Children's Marriage -->
          <div class="section">
            <div class="label">Children's Marriage</div>
            <div class="grid two" style="margin-top:8px">
              <div class="pillInput"><span class="prefix">Child Name</span><input id="g_cm_name" type="text" placeholder="e.g., Aarav"/></div>
              <div class="pillInput"><span class="prefix">Expected Age</span><input id="g_cm_age" type="number" placeholder="Expected age at marriage"/></div>
              <div class="pillInput"><span class="prefix">USD (today)</span><input id="g_cm_cost" type="number" placeholder="Estimated cost in today's terms"/></div>
            </div>
          </div>

          <!-- c) Retirement -->
          <div class="section">
            <div class="label">Retirement</div>
            <div class="grid three" style="margin-top:8px">
              <div class="pillInput"><span class="prefix">Husband Age</span><input id="g_ret_h_age" type="number" placeholder="Planned retirement age (Husband)"/></div>
              <div class="pillInput"><span class="prefix">Wife Age</span><input id="g_ret_w_age" type="number" placeholder="Planned retirement age (Wife)"/></div>
              <div class="pillInput"><span class="prefix">% of now</span><input id="g_ret_exp_pct" type="number" placeholder="Expected monthly expenses post-retirement (%)"/></div>
            </div>
          </div>

          <!-- d) Vacation -->
          <div class="section">
            <div class="label">Vacation</div>
            <div class="grid two" style="margin-top:8px">
              <div class="pillInput"><span class="prefix">USD (today)</span><input id="g_vac_annual" type="number" placeholder="Annual Vacation Expenses - in today's terms"/></div>
              <div class="pillInput"><span class="prefix">Until age</span><input id="g_vac_until_age" type="number" placeholder="Planned annual vacation until age (post-retirement)"/></div>
            </div>
          </div>

          <!-- e) Home Purchase -->
          <div class="section">
            <div class="label">Home Purchase</div>
            <div class="grid two" style="margin-top:8px">
              <div class="pillInput"><span class="prefix">Target Date</span><input id="g_home_date" type="date" placeholder="Target Purchase Date"/></div>
              <div class="pillInput"><span class="prefix">USD (today)</span><input id="g_home_cost" type="number" placeholder="Estimated cost in today's terms"/></div>
            </div>
          </div>

          <!-- f) Car Purchase -->
          <div class="section">
            <div class="label">Car Purchase</div>
            <div class="grid three" style="margin-top:8px">
              <div class="pillInput"><span class="prefix">USD</span><input id="g_car_budget" type="number" placeholder="Car Purchase Budget"/></div>
              <div class="pillInput"><span class="prefix">Freq (yrs)</span><input id="g_car_freq" type="number" placeholder="Frequency of car purchase in years"/></div>
              <div class="pillInput"><span class="prefix">Until age</span><input id="g_car_until_age" type="number" placeholder="Planned car purchases until age (post-retirement)"/></div>
            </div>
          </div>

          <!-- g) Other Goals -->
          <div class="section" style="border-bottom:0">
            <div class="label">Any Other Key Goals (Charity / Farm House / Business Investments etc.)</div>
            <div class="grid three" style="margin-top:8px">
              <div class="pillInput"><span class="prefix">Goal</span><input id="g_other_name" type="text" placeholder="Goal Name"/></div>
              <div class="pillInput"><span class="prefix">USD (today)</span><input id="g_other_amt" type="number" placeholder="Goal Amount - in today's terms"/></div>
              <div class="pillInput"><span class="prefix">Target Date</span><input id="g_other_date" type="date" placeholder="Target Goal Date"/></div>
            </div>
          </div>

        </div>
      </details>

      <!-- 10) INSURANCES (new section) -->
      <details class="card" id="insurances" open>
        <summary><span class="badge">10</span><strong>Insurances</strong></summary>
        <div class="content">

          <div class="section">
            <div class="label">Life Insurance</div>
            <div class="grid three" style="margin-top:8px">
              <div class="pillInput"><span class="prefix">Type</span>
                <select id="ins_life_type">
                  <option value="">Select</option>
                  <option>Term</option>
                  <option>Endowment</option>
                  <option>ULIP</option>
                  <option>Whole Life</option>
                </select>
              </div>
              <div class="pillInput"><span class="prefix">USD</span><input id="ins_life_sum" type="number" placeholder="Life Coverage Amount - Sum Assured"/></div>
              <div class="pillInput"><span class="prefix">Maturity Age</span><input id="ins_life_term" type="number" placeholder="Policy Term - Maturity Age"/></div>
            </div>
          </div>

          <div class="section" style="border-bottom:0">
            <div class="label">Health Insurance</div>
            <div class="grid three" style="margin-top:8px">
              <div class="pillInput"><span class="prefix">Type</span>
                <select id="ins_health_type">
                  <option value="">Select</option>
                  <option>Individual</option>
                  <option>Family Floater</option>
                  <option>TopUp</option>
                </select>
              </div>
              <div class="pillInput"><span class="prefix">USD</span><input id="ins_health_sum" type="number" placeholder="Coverage Amount"/></div>
            </div>
          </div>

        </div>
      </details>

    </div>
  </div>

<script>
  const KEY='kristalV5PlusTheme'; const saved=localStorage.getItem(KEY); if(saved) document.documentElement.setAttribute('data-theme', saved);
  document.getElementById('themeToggle').addEventListener('click', ()=>{
    const cur=document.documentElement.getAttribute('data-theme')||'light';
    const next=cur==='light'?'dark':'light';
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem(KEY,next);
  });
  // Simple steppers
  document.querySelectorAll('[data-step]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id=btn.getAttribute('data-step'); const delta=Number(btn.getAttribute('data-delta'));
      const el=document.getElementById(id); if(!el) return;
      const v=Number(el.value||0)+delta; el.value=v<0?0:v;
    });
  });
  // Mirror a few sliders from v5
  const bindPair=(txtId, rangeId)=>{
    const t=document.getElementById(txtId), r=document.getElementById(rangeId);
    if(!t||!r) return;
    const parse=(x)=>Number(String(x).replace(/[^0-9.\-]/g,''))||0;
    const fmt=(n)=>{const x=Math.round(n);return (x<0?'-':'')+'$'+Math.abs(x).toLocaleString('en-US');};
    t.addEventListener('input', ()=>{r.value=parse(t.value)});
    r.addEventListener('input', ()=>{t.value=fmt(r.value)});
    r.dispatchEvent(new Event('input'));
  };
  bindPair('rent_pa','s_rent_pa');
  bindPair('emi_pa','s_emi_pa');
</script>

<script>
// === Auto-calculation logic (USD) ===
(function(){
  const $ = (s)=>document.querySelector(s);
  const parseNum = (s)=>Number(String(s||'').replace(/[^0-9.\-]/g,''))||0;
  const fmtUSD = (n)=>{
    const x = Math.round(n);
    return (x<0?'-':'') + '$' + Math.abs(x).toLocaleString('en-US');
  };
  const v = (id)=>{ const el=document.getElementById(id); return el ? parseNum(el.value) : 0; };

  function recalc(){
    // Gross Monthly Income = monthly salary + (annual incomes)/12
    const gmi = v('inc_takehome') + (v('inc_bonus') + v('inc_rent') + v('inc_business') + v('inc_invest') + v('inc_other'))/12;

    // Monthly Expenses (exclude debt EMIs)
    const monthlyFixed = v('exp_rent') + v('exp_school') + v('exp_household');
    const monthlyAnnuals = (v('exp_vac') + v('exp_disc') + v('exp_life') + v('exp_health') + v('exp_maint'))/12;
    const me = monthlyFixed + monthlyAnnuals;

    // Monthly Debt = all EMIs + (EMI p.a ÷ 12)
    const md = v('loan_home_emi') + v('loan_car_emi') + v('loan_personal_emi') + v('loan_edu_emi') + v('loan_biz_emi') + v('loan_other_emi') + (v('emi_pa')/12);

    // Surplus, Savings Rate, DTI
    const nms = gmi - me - md;
    const nas = nms * 12;
    const sr  = gmi > 0 ? (nms / gmi) * 100 : 0;
    const dti = gmi > 0 ? (md / gmi) * 100 : 0;

    // Net Worth = Assets - Liabilities
    const assets = v('invest_now')
      + v('inv_mf') + v('inv_stocks') + v('inv_bonds_fd')
      + v('inv_ppf_epf_nps') + v('inv_savings_bank') + v('inv_realestate')
      + v('inv_gold') + v('inv_other') + v('inv_any_other_5lac');
    const liabilities = v('loan_home_out') + v('loan_car_out') + v('loan_personal_out')
      + v('loan_edu_out') + v('loan_biz_out') + v('loan_other_out');

    const nw = assets - liabilities;

    // Update tiles
    $('#t_gmi').textContent = fmtUSD(gmi);
    $('#t_me').textContent  = fmtUSD(me);
    $('#t_md').textContent  = fmtUSD(md);
    $('#t_nms').textContent = fmtUSD(nms);
    $('#t_nas').textContent = fmtUSD(nas);
    $('#t_sr').textContent  = sr.toFixed(1) + '%';
    $('#t_dti').textContent = dti.toFixed(1) + '%';
    $('#t_nw').textContent  = fmtUSD(nw);
  }

  // Recalc on all inputs/selects
  document.querySelectorAll('input, select').forEach(el => el.addEventListener('input', recalc));
  // Also recalc when sliders/steppers fire synthetic events
  document.addEventListener('recalc', recalc);
  // Initial calc
  recalc();
})();
</script>

</body>
</html>
